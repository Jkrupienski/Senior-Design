<!DOCTYPE html>
<html lang="en">  <!-- specifies doc type and language of the document -->
<head>
    <meta charset="UTF-8">  <!-- set char encoding for doc -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- ensure page is responsive, set viewpoint as device's width -->
    <title>Live Lane Traffic Volume</title>  <!-- webpage title in browser tab -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  <!-- includes Chart.js library to render charts -->
</head>
<body>
    <h1>Live Lane Traffic Volume</h1>  <!-- heading of webpage -->
    <canvas id="trafficChart"></canvas>  <!-- canvas where chart will be placed -->
    <script>
        let trafficChart;  // declare variable to hold chart

        async function fetchData() {
            const response = await fetch('/data');  // fetch data from server endpoint
            const data = await response.json();  // parse data response as json
            return data;  // return parsed data
        }

        async function createChart() {
            const data = await fetchData();  // call fetchData to initialize data
            const ctx = document.getElementById('trafficChart').getContext('2d');  // get 2d context for canvas
            trafficChart = new Chart(ctx, {  // create new Chart.js instance
                type: 'line',  // specify type as a line chart
                data: {
                    labels: data.time.reverse(),  // set x-axis labels, reverse order to display recent data first
                    datasets: [
                        {
                            label: 'Lane One',  // label first data set
                            data: data.lane_One.reverse(),  // data points for lane one and REVERSED for time order
                            borderColor: 'red',  // set color of line
                            fill: false  // do not fill below line
                        },
                        {
                            label: 'Lane Two',  // same as above
                            data: data.lane_Two.reverse(),
                            borderColor: 'green',
                            fill: false
                        },
                        {
                            label: 'Lane Three',  // same as above
                            data: data.lane_Three.reverse(),
                            borderColor: 'blue',
                            fill: false
                        }
                        // ADD TOTAL FOR ROAD
                    ]
                },
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,  // display x-axis title
                                text: 'Time'  // label x-axis
                            }
                        },
                        y: {
                            title: {
                                display: true,  // display y-axis title
                                text: 'Traffic Volume'  // label
                            }
                        }
                    }
                }
            });
        }

        async function updateChart() {
            const data = await fetchData();  // fetch latest data from server
            trafficChart.data.labels = data.time.reverse();  // updates x-axis labels with new data
            trafficChart.data.datasets[0].data = data.lane_One.reverse();  // updates data points for lane one
            trafficChart.data.datasets[1].data = data.lane_Two.reverse();  // update lane two
            trafficChart.data.datasets[2].data = data.lane_Three.reverse();  // lane three
            trafficChart.update();  // redraw chart with updated data
        }

        setInterval(updateChart, 30000);  // update every 30 seconds
        createChart();  // call to create and update the chart
    </script>
</body>
</html>
